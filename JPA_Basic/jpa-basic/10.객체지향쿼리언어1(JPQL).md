### 객체지향 쿼리 언어 (JPQL)

JPA의 다양한 쿼리 방법을 지원
- JPQL : 표준 문법
- JPA Criteria : 자바 코드로 짜서 JPQL을 빌드해주는 제네레이터 클래스의 모음
- QueryDSL : 자바 코드로 짜서 JPQL을 빌드해주는 제네레이터 클래스의 모음
- 네이티브 SQL : 특정 SQL의 종속적인 쿼리를 실행하기 위함
- JDBC API 직접사용, MyBatis, SpringJdbcTemplate 함께 사용

### JPQL 소개
검색 기능 강조

가장 단순환 조회 방법
    EntityManager.find()
    객체 그래프 탐색(a.getB().getC())
나이가 18살 이상인 회원을 모두 검색하고 싶다면 ?

- JPA를 사용하면 엔티티 객체 중심으로 개발
- 문제는 검색 쿼리
- 검색을 할 때도 테이블이 아닌 엔티티 객체를 대상으로 검색
- 모든 DB 데이터를 객체로 변환해서 검색하는 것은 불가능
- *** 애플리케이션이 필요한 데이터만 DB에서 불러오려면 결국 검색 조건이 포함된 SQL이 필요하다. ***

JPA는 SQL을 추상화한 JPQL이라는 객체 지향 쿼리 언어 제공
JPQL은 엔티티 객체를 대상으로 쿼리
SQL은 데이터베이스 테이블을 대상으로 쿼리

```java
List<Member> resultList = em.createQuery(
    "select m from Member m where m.userName like '%kim%'"
    , Member.class
).getResultList();
```

한마디로 JPQL은 객체지향 SQL이다.

##### Criteria
JPQL의 "select m from Member m where m.userName like '%kim%'" 쿼리는
단순한 스트링 타입일 뿐이기에 **동적 쿼리**를 만들기 어렵다.
만들수는 있지만 신경쓸 것도 많고 복잡해진다.(예. 문자 결합은 오류를 범하기 쉽다)

```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);
Root<Member> m = query.from(Member.class);
CriteriaQuery<Member> cq = query.select(m).where(cb.equal(m.get("userName"), "kim"));
List<Member> resultList1 = em.createQuery(cq).getResultList();
```
동적 쿼리를 짜기는 좋지만 유지보수가 어렵고 실용성이 없다.

### QueryDSL 사용
SQL을 코드로 짜는데 Criteria보다 보기도 좋고 동적 쿼리 짜는데 좋다.
- 문자가 아닌 자바코드로 JPQL을 작성할 수 있다.
- JPQL 빌더 역할
- **컴파일 시점**에 문법 오류를 찾을 수 있다.
- 동적 쿼리 작성이 편리하다.
- 단순하고 쉽다.
- 실무 사용 권장

모든 것은 JPQL으로 시작하기에 기본부터 충실해야한다.

##### 네이티브 SQL 소개
- JPA가 제공하는 SQL을 직접 사용하는 기능
- JPQL로 해결할 수 없는 특정 데이터베이스에 의존적인 기능
- 예) 오라클 CONNECT BY 등, 특정 DB만 사용하는 SQL 힌트

```java
em.createNativeQuery("select member_id, city from member").getResultList();
```

영환님은 잘 안쓰심

##### JDBC 직접 사용, SpringJdbcTemplate 등
- JPA를 사용하며 JDBC 커넥션을 직접 사용하거나, 스프링 JdbcTemplate, 마이바티스 등을 함께 사용 가능
- 단 영속성 컨텍스트를 적절한 시점에 강제로 플러시 필요
- 예) JPA를 우회해서 SQL을 실행하기 직전에 영속성 컨텍스트 수동 플러시

```java
Member member = new Member();
member.setUserName("HHH");
em.persist(member);
// 아직 SQL에 없음 flush를 해야함 / flush -> commit, query 날라갈 때 동작
List<Member> resultList = em.createNativeQuery("select * from member").getResultList();
```
nativequery를 사용해도 같은 JPQL이기에 영속성에만 있는 HHH도 출력된다.
하지만 JDBC로 Query를 날리면 나오지 않는다 그래서 강제로 flush()를 해줘야 한다.

### JPQL (Java Persistence Query Language)
JPQL 소개
객체지향 쿼리 언어이다.
엔티티 객체를 대상으로 쿼리한다.
SQL을 추상화해서 특정 데이터베이스 SQL에 의존하지 않는다.
JPQL은 결국 SQL로 변환된다.








































































