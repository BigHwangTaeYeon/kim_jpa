# 연관관계 매핑 기초
객체와 테이블 연관관계의 차이를 이해
객체의 참조와 테이블의 외래 키를 매핑

용어
    방향(Direction) : 단방향, 양방향
    다중성(Multiplicity) : 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)
    연관관계의 주인(Owner) : 객체 양방향 연관관계는 관리 주인이 필요

### 예제 시나리오
회원과 팀이 있다.
회원은 하나의 팀에만 소속될 수 있다.
회원과 팀은 다대일 관계다.
```java
public class Member{
    //    @Column(name="team_id")
    //    private Long teamId;
    @ManyToOne  // FK, Member 와 Team 관계는 N : 1이다. (팀 안에 여러 맴버가 속하기 때문)
    @JoinColumn(name = "team_id")   // Team 의 PK와 Member 의 FK의 Column
    private Team team;
}

public class Main {
    // 저장
    Team team = new Team();
    team.setName("TeamA");
    em.persist(team);
    
        Member member = new Member();
    member.setName("member1");
    member.setTeam(team);
    em.persist(member);
        // 영속성 컨텍스트에 데이터가 있기에 select 쿼리가 실행이 안된다.
    // 원한다면 em.flush(); em.clear();를 하면 된다.
    Member findMember = em.find(Member.class, member.getId());
    Team findTeamId = findMember.getTeam();

    // 수정
    Team newTeam = em.find(Team.class, 100L);
    findMember.setTeam(newTeam);
}
```

### 양방향 연관관계와 연관관계의 주인

##### 양방향 매핑
```java
@Entity
public class Member {
    @ManyToOne
    @JoinColumn(name = "team_id")
    private Team team;
}
@Entity
public class Team {
    @OneToMany(mappedBy = "team")   //Member Entity의 team 변수명에 맞춰줄 것이다라는 뜻
    private List<Member> members = new ArrayList<>();
}
public class JpaMain {
    public static void main(String[] args) {
        Member findMember = em.find(Member.class, member.getId());
        List<Member> findTeam = findMember.getTeam().getMembers();

        for (Member m : findTeam) {
            System.out.println("findTeam id : " + m.getName());
        }
    }
}
```

### 연관관계의 주인과 mappedBy
객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다.
    객체 연관관계 = 2개    
    (참조가 Member 엔티티에 Team team으로, Team 엔티티에 List members로 있다. 그렇게 다른 엔티티로 가기위해 참조값이 있어야 한다.)
        회원 > 팀 (단방향)
        팀 > 회원 (단방향)
    데이블 연관관계 = 1개   (FK 하나로 연관관계가 끝난다.)
        회원 <-> 팀의 연관관계 1개 (양방향)

객체의 양방향 관계는 서로 다른 단방향 관계 2개이다.
테이블은 외래 키 하나로 두 테이블의 연관관계를 관리한다.

### 연관관계의 주인(Owner)

둘(member, team) 중 하나로 외래 키를 관리해야 한다.
MEMBER
------
MEMBER_ID(PK)
TEAM_ID(FK)
USERNAME

양방향 매핑 규칙
    - 객체의 두 관계중 하나를 연관관계의 주인으로 지정
    - 연관관계의 주인만이 외래 키를 관리(등록, 수정)
    - 주인이 아닌쪽은 읽기만 가능
    - 주인은 mappedBy 속성 사용하면 안됨
    - 주인이 아니면 mappedBy 속성으로 주인 지정

* 외래 키가 있는 곳을 주인으로 정하라
헷갈릴 일이 없다












































